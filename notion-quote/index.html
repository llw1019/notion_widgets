<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notion Random Quote</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400&family=Roboto+Mono:wght@300;400&family=Roboto:wght@300;400&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --page-bg: #ffffff;
      --card-bg: #ffffff;
      --border-color: rgba(0, 0, 0, 0.12);
      --text-strong: #1f1f28;
      --text-muted: #6b7280;
      --accent: #ff7a18;
      --button-bg: rgba(255, 255, 255, 0.8);
      --button-text: #1f1f28;
      --button-border: rgba(0, 0, 0, 0.08);
      --card-shadow: 0 8px 16px rgba(15, 23, 42, 0.12);
      --panel-shadow: 0 6px 14px rgba(15, 23, 42, 0.2);
    }

    body.theme-dark {
      --page-bg: rgb(25, 25, 25);
      --card-bg: rgba(10, 11, 15, 0.92);
      --border-color: rgba(255, 255, 255, 0.18);
      --text-strong: #f4f5f7;
      --text-muted: #a3a8b8;
      --accent: #ffa95c;
      --button-bg: rgba(24, 26, 33, 0.9);
      --button-text: #f4f5f7;
      --button-border: rgba(255, 255, 255, 0.12);
      --card-shadow: 0 14px 24px rgba(0, 0, 0, 0.45);
      --panel-shadow: 0 12px 22px rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      padding: 20px;
      background: var(--page-bg);
      font-family: 'Roboto', sans-serif;
      transition: background 0.25s ease;
    }

    .viewport-shell {
      margin: 0 auto;
      max-width: 760px;
      border-radius: 28px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-strong);
      box-shadow: var(--card-shadow);
      padding: 48px 46px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      transition: background 0.25s ease, color 0.25s ease, border-color 0.25s ease;
      overflow: hidden;
    }

    .quote {
      font-size: 1.6rem;
      line-height: 1.6;
      margin: 0;
    }

    .quote .dash {
      display: inline-block;
      opacity: 0.18;
      margin-right: 8px;
    }

    .quote cite {
      font-size: 0.9rem;
      font-style: normal;
      color: var(--text-muted);
    }

    .mono {
      font-family: 'Roboto Mono', monospace;
    }

    .sans {
      font-family: 'Roboto', sans-serif;
    }

    .serif {
      font-family: 'Noto Serif JP', serif;
    }

    .control-panel {
      position: fixed;
      bottom: 24px;
      right: 24px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 16px 18px;
      border-radius: 22px;
      border: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.9);
      box-shadow: var(--panel-shadow);
      font-size: 0.85rem;
      color: var(--text-muted);
      opacity: 0;
      pointer-events: none;
      transform: translate3d(0, 8px, 0);
      transition: opacity 0.2s ease, transform 0.2s ease;
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    body.theme-dark .control-panel {
      background: rgba(12, 13, 17, 0.92);
    }

    .viewport-shell:hover .control-panel,
    .viewport-shell:focus-within .control-panel,
    .control-panel.panel-visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .panel-row {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: nowrap;
    }

    .controls-group {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
    }

    .pill-button {
      border: 1px solid var(--button-border);
      border-radius: 999px;
      background: var(--button-bg);
      color: var(--button-text);
      padding: 6px 14px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .pill-button:hover {
      transform: translateY(-1px);
    }

    .font-buttons {
      flex-wrap: wrap;
    }

    .font-buttons button {
      min-width: 54px;
      text-align: center;
    }

    .size-buttons button {
      width: 48px;
    }

    .mode-buttons .pill-button.light {
      background: #ffffff;
      color: #1f1f28;
      border-color: rgba(0, 0, 0, 0.15);
    }

    .mode-buttons .pill-button.dark {
      background: rgb(25, 25, 25);
      color: #f5f5f5;
      border-color: rgba(255, 255, 255, 0.25);
    }

    .mode-buttons .pill-button.clear-preferences {
      background: transparent;
      color: var(--accent);
      border-color: transparent;
      padding-right: 4px;
    }

    body.theme-dark .mode-buttons .pill-button.light {
      color: #1f1f28;
    }

    body.theme-dark .mode-buttons .pill-button.dark {
      background: rgb(25, 25, 25);
      color: #f5f5f5;
    }

    @media (max-width: 640px) {
      .viewport-shell {
        padding: 32px 28px;
      }

      .panel-row {
        flex-direction: column;
        align-items: stretch;
      }

      .controls-group {
        flex-wrap: wrap;
      }

      .control-panel {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="viewport-shell">
    <blockquote class="quote mono">
      <p class="content"></p>
      <div>
        <span class="dash">&horbar;</span>
        <cite title="Source Title"></cite>
      </div>
    </blockquote>
    <div class="control-panel" aria-label="Quote controls">
      <div class="panel-row">
        <button class="pill-button shuffle">Shuffle</button>
        <div class="mode-buttons controls-group">
          <button class="pill-button light">Light</button>
          <button class="pill-button dark">Dark</button>
          <button class="pill-button clear-preferences" type="button">Clear</button>
        </div>
      </div>
      <div class="panel-row">
        <div class="font-buttons controls-group">
          <button class="pill-button sans">Sans</button>
          <button class="pill-button serif">Serif</button>
          <button class="pill-button mono">Mono</button>
        </div>
        <div class="size-buttons controls-group">
          <button class="pill-button plus">A+</button>
          <button class="pill-button minus">A-</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const refs = {
        body: document.body,
        quote: document.querySelector(".quote"),
        quoteText: document.querySelector("blockquote p"),
        cite: document.querySelector("blockquote cite"),
        shuffle: document.querySelector(".shuffle"),
        fontButtons: document.querySelectorAll(".font-buttons button"),
        modeButtons: document.querySelectorAll(".mode-buttons button"),
        sizeButtons: document.querySelectorAll(".size-buttons button"),
        viewport: document.querySelector('.viewport-shell'),
        controlPanel: document.querySelector('.control-panel'),
        clearButton: document.querySelector('.clear-preferences')
      };
      let size = 1.5;
      const systemThemeQuery = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;

      /* Asynchronous function to update a quote from the quotable API. */
      async function updateQuote() {
        try {
          const response = await fetch("https://dummyjson.com/quotes/random");
          const data = await response.json();

          if (response.ok) {
              setQuoteContent(data.quote, data.author);
          } else {
              setQuoteContent("An error occurred", '');
            console.log(data);
          }
        } catch (error) {
            setQuoteContent("Oops! There is a problem with the quotes server.", '');
          console.log(error);
        }

      }
      /* Asynchronous function to update a custom quote. It takes in a parameter f and makes a fetch request to f.
         It then processes the response and updates the quote_text and cite elements based on the data received. */
      async function updateQuoteCustom(f) {
        try {
          const response = await fetch(f);
          const data = await response.json();
          if (response.ok && Array.isArray(data) && data.length) {
            const randomIndex = Math.floor(Math.random() * data.length);
            const randomQuote = data[randomIndex];
            setQuoteContent(randomQuote.content, randomQuote.author);
          } else {
            setQuoteContent("An error occurred", '');
            console.log(data);
          }
        } catch (error) {
          setQuoteContent("Oops! There is a problem with the custom quotes.", '');
          console.log(error);
        }
      }

      function setQuoteContent(text, author) {
        if (refs.quoteText) refs.quoteText.textContent = text || '';
        if (refs.cite) refs.cite.textContent = author || '';
      }

      /* Update the style based on the values stored in the localStorage. */
      function updateStyle() {
        const storedFont = localStorage.getItem('font');
        const font = storedFont || 'sans';
        changeFont(font, Boolean(storedFont));
        const storedTheme = localStorage.getItem('mode');
        const prefersDark = systemThemeQuery ? systemThemeQuery.matches : false;
        const theme = storedTheme || (prefersDark ? 'dark' : 'light');
        applyTheme(theme, Boolean(storedTheme));
        const storedSize = localStorage.getItem('size');
        size = parseFloat(storedSize) || 1.5;
        setSize(size, Boolean(storedSize));
      }

      function changeFont(value, persist = true) {
        if (!refs.quote) return;
        refs.quote.className = `quote ${value}`;
        if (persist) localStorage.setItem('font', value);
      }

      function applyTheme(theme, persist = true) {
        const useDark = theme === 'dark';
        refs.body.classList.toggle('theme-dark', useDark);
        refs.body.classList.toggle('theme-light', !useDark);
        if (persist) localStorage.setItem('mode', theme);
      }

      function changeSize(direction) {
        size = direction === 'plus' ? size + 0.1 : size - 0.1;
        size = Math.max(0.8, Math.min(2.4, parseFloat(size.toFixed(2))));
        setSize(size);
      }

      function setSize(value, persist = true) {
        if (!refs.quote) return;
        refs.quote.style.fontSize = `${value}rem`;
        if (persist) localStorage.setItem('size', value);
      }

      function loadQuote() {
        const url = new URL(window.location);
        const fileUrl = url.searchParams.get("f");
        if (!fileUrl) {
          updateQuote();
        } else {
          updateQuoteCustom(fileUrl);
        }
      }

      function handleSystemTheme(event) {
        if (!localStorage.getItem('mode')) {
          applyTheme(event.matches ? 'dark' : 'light', false);
        }
      }

      function setupPanelReveal() {
        if (!refs.viewport || !refs.controlPanel) return;
        let hideTimer = null;

        const showPanel = (temporary = false) => {
          refs.controlPanel.classList.add('panel-visible');
          if (temporary) {
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => {
              refs.controlPanel.classList.remove('panel-visible');
            }, 4000);
          }
        };

        const hidePanel = () => {
          if (refs.viewport && refs.viewport.matches(':hover')) return;
          if (refs.controlPanel.matches(':hover') || refs.controlPanel.matches(':focus-within')) return;
          refs.controlPanel.classList.remove('panel-visible');
        };

        refs.viewport.addEventListener('pointerenter', (event) => {
          if (event.pointerType === 'touch') return;
          showPanel();
        });

        refs.viewport.addEventListener('pointerleave', (event) => {
          if (event.pointerType === 'touch') return;
          hidePanel();
        });

        refs.viewport.addEventListener('touchstart', () => {
          showPanel(true);
        }, { passive: true });

        refs.controlPanel.addEventListener('mouseenter', showPanel);
        refs.controlPanel.addEventListener('mouseleave', hidePanel);
        refs.controlPanel.addEventListener('focusin', showPanel);
        refs.controlPanel.addEventListener('focusout', () => {
          setTimeout(() => {
            if (!refs.controlPanel.matches(':focus-within')) hidePanel();
          }, 0);
        });
      }

      window.addEventListener('storage', (event) => {
        if (event.key === 'mode') {
          const storedTheme = event.newValue || (systemThemeQuery && systemThemeQuery.matches ? 'dark' : 'light');
          applyTheme(storedTheme, false);
        }
        if (event.key === 'font' && event.newValue) {
          changeFont(event.newValue);
        }
        if (event.key === 'size' && event.newValue) {
          size = parseFloat(event.newValue) || size;
          setSize(size);
        }
      });

      refs.sizeButtons.forEach((button) => {
        button.addEventListener('click', () => changeSize(button.classList.contains('plus') ? 'plus' : 'minus'));
      });

      refs.fontButtons.forEach((button) => {
        button.addEventListener('click', () => changeFont(Array.from(button.classList).find(cls => ['sans', 'serif', 'mono'].includes(cls))));
      });

      refs.modeButtons.forEach((button) => {
        button.addEventListener('click', () => applyTheme(button.classList.contains('dark') ? 'dark' : 'light'));
      });

      if (refs.shuffle) refs.shuffle.addEventListener('click', loadQuote);
      if (refs.clearButton) {
        refs.clearButton.addEventListener('click', clearModePreference);
      }
      if (systemThemeQuery) {
        if (systemThemeQuery.addEventListener) {
          systemThemeQuery.addEventListener('change', handleSystemTheme);
        } else if (systemThemeQuery.addListener) {
          systemThemeQuery.addListener(handleSystemTheme);
        }
      }

      function clearModePreference() {
        localStorage.removeItem('mode');
        updateStyle();
      }

      setupPanelReveal();
      updateStyle();
      loadQuote();
    });
  </script>
</body>

</html>
